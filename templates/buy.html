<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Buy Stocks</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #fff;
      margin: 0;
      padding: 0;
    }

    .navbar {
      border-bottom: 1px solid #e7e2ff;
      padding: 12px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .nav-brand {
      font-weight: bold;
      font-size: 16px;
      color: #3b2a86;
    }

    .nav-links {
      display: flex;
      gap: 12px;
    }

    .nav-links a {
      text-decoration: none;
      color: #3b2a86;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #e7e2ff;
    }

    .nav-links a:hover {
      background: #f4f1ff;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #e7e2ff;
      border-radius: 10px;
      background: #f9f7ff;
    }

    h1 {
      color: #3b2a86;
      margin-top: 0;
    }

    .form-group {
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: bold;
      color: #3b2a86;
      margin-bottom: 6px;
      font-size: 14px;
    }

    input, select {
      padding: 10px;
      border: 1px solid #e7e2ff;
      border-radius: 6px;
      font-size: 14px;
      background: #fff;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #6d3cff;
      box-shadow: 0 0 0 3px rgba(109, 60, 255, 0.1);
    }

    .info-box {
      background: #ece6ff;
      border: 1px solid #d9ceff;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #3b2a86;
    }

    .price-preview {
      background: #f0eaff;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 14px;
      color: #3b2a86;
    }

    button {
      background: #6d3cff;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      width: 100%;
    }

    button:hover {
      background: #5a2dd8;
    }

    button:active {
      transform: scale(0.98);
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #6d3cff;
      text-decoration: none;
      font-size: 14px;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .error {
      color: #d32f2f;
      font-size: 13px;
      margin-top: 4px;
    }

    .success {
      background: #c8e6c9;
      color: #2e7d32;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="navbar">
    <div class="nav-brand">üìà Stock Trading App</div>
    <div class="nav-links">
      <a href="{{ url_for('dashboard') }}">Dashboard</a>
      <a href="{{ url_for('logout') }}">Logout</a>
    </div>
  </div>

  <div class="container">
    <a href="{{ url_for('dashboard') }}" class="back-link">‚Üê Back to Dashboard</a>
    <h1>Buy Stocks</h1>

    {% if error %}
      <div class="info-box" style="background: #ffebee; border-color: #ffcdd2; color: #c62828;">
        {{ error }}
      </div>
    {% endif %}

    {% if success %}
      <div class="success" style="display: block;">
        Order placed successfully! Check pending orders on your dashboard.
      </div>
    {% endif %}

    <div class="info-box">
      <strong>Available Cash:</strong> ${{ '%.2f' | format(cash) }}
    </div>

<form method="POST" action="{{ url_for('buy') }}" id="buyForm">
        <div class="form-group">
        <label for="company">Company Name *</label>
        <input 
          type="text" 
          id="company" 
          name="company" 
          placeholder="e.g., Apple Inc" 
          required 
        />
      </div>

      <div class="form-group">
        <label for="ticker">Stock Ticker *</label>
        <input 
          type="text" 
          id="ticker" 
          name="ticker" 
          placeholder="e.g., AAPL" 
          maxlength="5"
          required 
        />
        <span class="error" style="display: none;" id="tickerError">Ticker must be 1-5 characters</span>
      </div>

      <div class="form-group">
        <label for="shares">Number of Shares *</label>
        <input 
          type="number" 
          id="shares" 
          name="shares" 
          placeholder="e.g., 10" 
          min="1"
          step="1"
          required 
        />
        <span class="error" style="display: none;" id="sharesError">Must be a positive integer</span>
      </div>

      <div class="form-group">
        <label for="price">Price per Share ($) *</label>
        <input 
          type="number" 
          id="price" 
          name="price" 
          placeholder="e.g., 150.25" 
          min="0.01"
          step="0.01"
          required 
        />
        <span class="error" style="display: none;" id="priceError">Must be a positive number</span>
      </div>

      <div class="price-preview">
        <strong>Total Cost:</strong> $<span id="totalCost">0.00</span>
        <div id="insufficientFunds" style="color: #d32f2f; margin-top: 6px; display: none;">
          ‚ö†Ô∏è Insufficient funds (available: ${{ '%.2f' | format(cash) }})
        </div>
      </div>

      <button type="submit" id="submitBtn">Place Buy Order</button>
    </form>
  </div>

  <script>
    const sharesInput = document.getElementById('shares');
    const priceInput = document.getElementById('price');
    const totalCostSpan = document.getElementById('totalCost');
    const insufficientFundsDiv = document.getElementById('insufficientFunds');
    const submitBtn = document.getElementById('submitBtn');
    const availableCash = {{ cash }};

    function updateTotalCost() {
      const shares = parseFloat(sharesInput.value) || 0;
      const price = parseFloat(priceInput.value) || 0;
      const total = (shares * price).toFixed(2);
      totalCostSpan.textContent = total;

      // Check if user has enough funds
      if (total > availableCash) {
        insufficientFundsDiv.style.display = 'block';
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.6';
      } else {
        insufficientFundsDiv.style.display = 'none';
        submitBtn.disabled = false;
        submitBtn.style.opacity = '1';
      }
    }

    sharesInput.addEventListener('input', updateTotalCost);
    priceInput.addEventListener('input', updateTotalCost);

    // Form validation
    document.getElementById('buyForm').addEventListener('submit', function(e) {
      const ticker = document.getElementById('ticker').value.trim();
      const shares = parseInt(sharesInput.value);
      const price = parseFloat(priceInput.value);

      let hasError = false;

      if (ticker.length === 0 || ticker.length > 5) {
        document.getElementById('tickerError').style.display = 'block';
        hasError = true;
      } else {
        document.getElementById('tickerError').style.display = 'none';
      }

      if (shares < 1 || !Number.isInteger(shares)) {
        document.getElementById('sharesError').style.display = 'block';
        hasError = true;
      } else {
        document.getElementById('sharesError').style.display = 'none';
      }

      if (price <= 0) {
        document.getElementById('priceError').style.display = 'block';
        hasError = true;
      } else {
        document.getElementById('priceError').style.display = 'none';
      }

      if (hasError) {
        e.preventDefault();
      }
    });
  </script>
</body>
</html>